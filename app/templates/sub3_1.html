<!--#include virtual = common/dbcon.asp-->
{#
<%
bansort=checkParameter("int",Request("bansort"))
Search=checkParameter("char",Request("Search"))
SearchStr=checkParameter("char",Request("SearchStr"))
IF bansort="" Then bansort=1

Page=GetPage()
PageSize=5

Sql="select top "&PageSize&" idx,title,filenames,bansort,note1,note2,content1,content2,email from resultadmin WHERE bansort=? AND idx NOT IN (select top "&(Page-1)*PageSize&" idx from resultadmin Where bansort=? order by listnum ASC, Idx DESC) order by listnum ASC, Idx DESC; select count(idx) from resultadmin Where bansort=?"
Set objCmd = Server.CreateObject("ADODB.Command")
With objCmd
    .ActiveConnection = DBcon
    .CommandType = adCmdText
    .CommandText = Sql
    
    .Parameters.Append .CreateParameter("@Par", adBigint, adParamInput, 8, bansort)
    .Parameters.Append .CreateParameter("@Par", adBigint, adParamInput, 8, bansort)
    .Parameters.Append .CreateParameter("@Par", adBigint, adParamInput, 8, bansort)
End With
Set Rs = objCmd.Execute()
Set objCmd = Nothing

IF Not(Rs.Bof Or Rs.Eof) Then
    Allrec=Rs.GetRows
    Record_Cnt=Rs.NextRecordSet
    TotalPage=Int((CInt(Record_Cnt(0))-1)/CInt(PageSize)) +1
    Count=Record_Cnt(0)
Else
    Count=0
End IF

Sql="SELECT bansort FROM resultadmin Group By bansort Order by bansort ASC"
Set Rs=DBcon.Execute(Sql)
IF Not(Rs.Bof Or Rs.Eof) Then YearRec=Rs.GetRows()
Rs.Close

Set Rs=Nothing
DBcon.Close
Set DBcon=Nothing

%>
#}

{% macro PT_SelectBox(YearRec) -%}
    {% for cycle in YearRec %}
        <option value="{{ cycle }}" {% if loop.first %}selected{% endif %}>{{ cycle }}기</option>
    {% endfor %}
{%- endmacro %}




{% extends "base.html" %}
{% block container %}
    <!--container-->
    <div id="container">
        <div class="contain">
            <div class="s_contents">
                {% include "right_login.html" %}
                {% include "left.html" %}
            </div>
            <div class="con">
                <ul>
                    <li class="stit"><img src="{{ url_for('static', filename='images/stit%d_%d.gif' % (mNum, sNum)) }}" alt="" /></li>
                    <li class="con_img">
                        <div class="board_search">
                            <select name="bansort" class="" onchange="loadPeople(this.value)">
                            <option selected> - 기수선택 - </option>
                            {{ PT_SelectBox(yearRec) }}
                            </select>
                        </div>
                        <ul class="people">
                        {% include "people.html" %}
                        </ul>
                        <center><div><%=PT_SpPageLink("","bansort="&bansort,"")%></div></center>
                    </li>
                </ul>
            </div>
            <script type="text/javascript">
                var loadPeople = function(cycle) {
                    var url = "{{ url_for('api.show_people', cycle=1) }}";
                    url = url.substr(0, url.length - 1) + cycle;
                    (function($) {
                        $.ajax({
                            method: "GET",
                            url: url,
                            success: function(data) {
                                $(".people").html(data);
                            }
                        });
                    })(jQuery);
                };
            </script>
        </div>
    </div>
    <!--//container-->
{% endblock %}