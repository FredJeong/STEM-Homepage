{#
<!--#include virtual = common/dbcon.asp-->
<% HK_returnURL="/member/modify.asp" %>
<!--#include virtual = common/sessionchk.asp-->
<%
Dim Sql,MemberRec,i,strLocation
Dim id,name,icode,Zip,addr1,addr2,tel,email,phone,job,note,mailling

Sql="Select id,pwd,name,zipcode,addr1,addr2,tel,phone,email,filename,EmailYN,Memsort,smsYN,birthday,sex from members Where idx=?"
Set objCmd = Server.CreateObject("ADODB.Command")
With objCmd
    .ActiveConnection = DBcon
    .CommandType = adCmdText
    .CommandText = Sql
    
    .Parameters.Append .CreateParameter("@idx", adBigint, adParamInput, 8, Session("useridx"))
End With
Set Rs = objCmd.Execute()
Set objCmd = Nothing

id=ReplaceTextField(Rs("id")) : pwd=Rs("pwd")
name=ReplaceTextField(Rs("name"))
Zip=Split(Rs("zipcode"),"-") : addr1=ReplaceTextField(Rs("addr1"))
addr2=ReplaceTextField(Rs("addr2")) : tel=Split(Rs("tel"),"-")
phone=Split(Rs("phone"),"-") : email=ReplaceTextField(Rs("email"))
filename=Rs("filename")
EmailYN=Rs("EmailYN")
smsYN=Rs("smsYN")
Memsort=Rs("memsort")

birthday=Split(Rs("birthday"),"-")
sex=ReplaceTextField(Rs("sex"))

EmailStr = Split(email,"@")

Set MemberRec=Nothing
DBcon.Close
Set DBcon=Nothing
%>
#}
{% extends "base.html" %}
{% block container %}
<script type="text/javascript">
<!--
// 한글 입력 검색
function hangul_chk(word) {
    var str = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890-";

    for (i=0; i< word.length; i++){
        idcheck = word.charAt(i);
        for ( j = 0 ;  j < str.length ; j++){
            if (idcheck == str.charAt(j)) break;
                 if (j+1 == str.length){
                   return false;
             }
         }
     }
    return true;
}

// 한글 입력 검색
function email_chk(word) {
    var str = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890-._@";

    for (i=0; i< word.length; i++)
    {
        idcheck = word.charAt(i);

        for ( j = 0 ;  j < str.length ; j++){

            if (idcheck == str.charAt(j)) break;

                 if (j+1 == str.length){
                   return false;
                 }
             }
         }
         return true;
}

function sendit(){
    var    Modify=document.Modify;

    if (Modify.passwd_original.value === "") {
        alert("맨 아래의 비밀번호 확인을 입력하세요.");
        Modify.passwd_original.focus();
        return;
    }

    if (Modify.passwd.value !== ""){
        if (hangul_chk(Modify.passwd.value) != true ){
            alert("비밀번호에 한글이나 여백은 사용할 수 없습니다.");
            Modify.passwd.focus();
             return;
        }
        if (Modify.passwd.value.length < 6 || Modify.passwd.value.length > 15) {
            alert("비밀번호는 6~15자리입니다.");
            Modify.passwd.focus();
            return;
        }
        if (Modify.passwd.value!==Modify.passwd_check.value){
            alert("비밀번호가 일치하지 않습니다. 다시 입력하여 주십시요.");
            Modify.passwd.focus();
            return;
        }
    }

    Modify.target="iframes";
    Modify.submit();
}
//-->
</script>

    <div id="container">
        <div class="contain">
            <div class="s_contents">
                {% include "right_login.html" %}
                {% include "left.html" %}
            </div>
            <div class="con">
                <ul class="nostyle">
                    <li class="nostyle stit"><img src="/images/stit6_3.gif" alt="" /></li>
                    <li class="nostyle con_img">

<p style="text-align:right;"><img src="{{url_for('static', filename='images/ico_arrow_orange.png')}}" alt="" title="" /> 필수 입력 사항입니다.</p>
<form name="Modify" method="POST" action="{{ url_for('modify')}}" enctype="multipart/form-data">
{{ form.hidden_tag() }}
<input type=hidden value="{{ next or '' }}" name=next>
<table cellspacing="0" class="tbl_join" summary="개인회원정보수정">
<caption>개인회원정보수정</caption>
<colgroup>
    <col width="110">
    <col>
</colgroup>
<tbody>
    <tr>
        <th scope="row" height='20'>이름</th>
        <td style="padding:5px 0 5px 10px;">{{ current_user.nickname }}</td>
    </tr>
    <tr>
        <th scope="row">아이디</th>
        <td style="padding:5px 0 5px 10px;">{{ current_user.username }}</td>
    </tr>
    <!--
    
    <tr>
        <th scope="row" class="import">성별</th>
        <td style="padding:5px 0 5px 10px;">
            <input type="radio" name="sex" value="남" <%=ChangeChecked("남",Sex)%>>남
            <input type="radio" name="sex" value="여" <%=ChangeChecked("여",Sex)%>>여
        </td>
    </tr>
    -->
    <tr>
        <th scope="row">비밀번호</th>
        <td style="padding:5px 0 5px 10px;"><input name="passwd" type="password" class="input" size="15" maxlength='15'> * 6~15자로 입력해주세요.</td>
    </tr>
    <tr>
        <th scope="row">비밀번호 확인</th>
        <td style="padding:5px 0 5px 10px;"><input name="passwd_check" type="password" class="input" size="15" maxlength='15'></td>
    </tr>
    <tr>
        <th scope="row">E-mail</th>
        <td style="padding:5px 0 5px 10px;">
            <input name="email" size="46" maxlength="50" type="text" class="input" value="{{ current_user.email }}">
             * 아이디/비번 분실시 필수.
        </td>
    </tr>
</tbody>
</table>

{% if current_user.member %}
<br>
<h4>공우 회원 정보 수정</h4>
<table cellspacing="0" class="tbl_join tbl_member" summary="공우 회원 정보 수정">
<caption>공우 회원 정보 수정</caption>
<colgroup>
    <col width="110">
    <col>
</colgroup>
<tbody>
    <tr>
        <th scope="row" class="import">핸드폰번호</th>
        <td style="padding:5px 0 5px 10px;">
            <input name="cell" type="text" class="input" size="20" maxlength="20" onKeyPress='if( event.keyCode !== 45 && (event.keyCode<48) || (event.keyCode>57) ) event.returnValue=false;' style='IME-MODE:disabled' value="{{current_user.member.phone}}">
        </td>
    </tr>
    <tr>
        <th scope="row" class="import">생년월일</th>
        <td style="padding:5px 0 5px 10px;">
            <input name="birthday" maxlength="10" type="date" class="input" value="{{current_user.member.birthday}}"/>
        </td>
    </tr>
    <tr>
        <th scope="row" class="import">기수</th>
        <td style="padding:5px 0 5px 10px;"><input name="cycle" type="text" class="input" size="3" maxlength='3' value="{{current_user.member.cycle}}">기</td>
    </tr>
    <tr>
        <th scope="row" class="import">소속 학과(부)</th>
        <td style="padding:5px 0 5px 10px;"><select name="department" class="input">
        {% for dept in departments %}
        <option value="{{dept.id}}"{% if dept.id == current_user.member.dept_id %} selected {% endif %}>{{dept.name}}</option>
        {% endfor %}
        </select></td>
    </tr>
    <tr>
        <th scope="row" class="import">부서</th>
        <td style="padding:5px 0 5px 10px;"><select name="stem_department" class="input">
        {% for dept in stem_departments %}
        <option value="{{dept.id}}" {% if dept.id == current_user.member.stem_dept_id %} selected {% endif %}>{{dept.name}}</option>
        {% endfor %}
        </select></td>
    </tr>
    <tr>
        <th scope="row">Awards & Career</th>
        <td style="padding:5px 0 5px 10px;"><textarea style="width:98%"class="input" rows="5" name="cv">{{ current_user.member.cv }}</textarea></td>
    </tr>
    <tr>
        <th scope="row">Comments</th>
        <td style="padding:5px 0 5px 10px;"><textarea style="width:98%" class="input" rows="5" name="comment">{{ current_user.member.comment }}</textarea></td>
    </tr>
    <tr>
        <th scope="row" class="import">사진</th>
        <td style="padding:5px 0 5px 10px;"><input name="photo" type="file" class="input"></td>
    </tr>
    <!--
    <tr>
        <th scope="row" class="import">사는 곳</th>
        <td style="padding:5px 0 5px 10px;">
            <p style="padding:4px 0 0 0;"><input name="addr" type="text" class="input" size="50" readonly value=""></p>
        </td>
    </tr>
    -->
</tbody>
</table>

{% endif %}

<br>
<h4>비밀번호 확인</h4>
<table cellspacing="0" class="tbl_join tbl_member" summary="비밀번호 확인">
<caption>비밀번호 확인</caption>
<colgroup>
    <col width="110">
    <col>
</colgroup>
<tbody>
    <tr>
        <th scope="row" class="import">비밀번호</th>
        <td style="padding:5px 0 5px 10px;">
            <input name="passwd_original" type="password" class="input" size="20" maxlength="20">
        </td>
    </tr>
</tbody>
</table>
</form>
<iframe name='iframes' frameborder='0' width='0' height='0'></iframe>
<p style="padding:15px 0; text-align:center;">
    <input type="button" title="" value="회원정보수정" class="button2" style='cursor:pointer;' onclick="sendit()">
    <input type="button" title="" value="취 소" class="button1" style='cursor:pointer;' onclick="history.back()">
</p>

                    </li>
                </ul>
            </div>
        </div>
    </div>
{% endblock %}
